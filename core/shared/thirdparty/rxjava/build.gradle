buildscript {
    // HACK: Allow android studio to support older versions of Gradle,
    // since the J2ObjC plugin only supports up-to Gradle 2.8
    // See: https://github.com/j2objc-contrib/j2objc-gradle/issues/613
    // and https://github.com/j2objc-contrib/j2objc-gradle/issues/568#issuecomment-236069034
    System.properties['com.android.build.gradle.overrideVersionCheck'] = 'true'
    repositories { jcenter() }

  dependencies {
      classpath 'com.netflix.nebula:gradle-rxjava-project-plugin:4.0.0'
      classpath files('../../../misc/j2objc-gradle-0.6.3-modified-alpha-SNAPSHOT.jar')

  }
}

description = 'RxJava: Reactive Extensions for the JVM â€“ a library for composing asynchronous and event-based programs using observable sequences for the Java VM.'

apply plugin: 'java'
apply plugin: 'nebula.rxjava-project'
// HACK Add support for J2ObjC
apply plugin: 'com.github.j2objccontrib.j2objcgradle'

dependencies {
    testCompile 'junit:junit:4.12'
    testCompile 'org.mockito:mockito-core:1.8.5'

    perfCompile 'org.openjdk.jmh:jmh-core:1.11.3'
    perfCompile 'org.openjdk.jmh:jmh-generator-annprocess:1.11.3'
}

javadoc {
    exclude "**/rx/internal/**"
    exclude "**/test/**"
    exclude "**/perf/**"
    options {
        windowTitle = "RxJava Javadoc ${project.version}"
    }
    // Clear the following options to make the docs consistent with the old format
    options.addStringOption('top').value = ''
    options.addStringOption('doctitle').value = ''
    options.addStringOption('header').value = ''
    if (JavaVersion.current().isJava7()) {
        // "./gradle/stylesheet.css" only supports Java 7
        options.addStringOption('stylesheetfile', rootProject.file('./gradle/stylesheet.css').toString())
    }
}

// support for snapshot/final releases with the various branches RxJava uses
//nebulaRelease {
//    addReleaseBranchPattern(/\d+\.\d+\.\d+/)
//    addReleaseBranchPattern('HEAD')
//}

if (project.hasProperty('release.useLastTag')) {
    tasks.prepare.enabled = false
}

test{
     maxHeapSize = "2g"
}

// Plugin settings; put these at the bottom of the file.
j2objcConfig {
    // Support current versions of J2ObjC
    // see: https://github.com/j2objc-contrib/j2objc-gradle/issues/621
    j2objcVersion "1.1"

    // Sets up libraries you depend on
    //autoConfigureDeps true

    // Add Prefix to Transpiled code
    //translateArgs '--prefixes', 'j2objcprefixes.properties'

    // Use ARC
    translateArgs '-use-arc'
    extraObjcCompilerArgs '-fobjc-arc', '-Wno-deprecated-declarations'



    // Omit these two lines if you don't configure your Xcode project with CocoaPods
    //xcodeProjectDir '../../ios'  //  suggested directory name
    //xcodeTargetsIos 'IOS-APP', 'IOS-APPTests'  // replace with your iOS targets

    finalConfigure()          // Must be last call to configuration
}
